<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<link rel="alternate"
      type="application/rss+xml"
      href="https://whatacold.github.io/rss.xml"
      title="RSS feed for https://whatacold.github.io/"/>
<title>whatacold's blog site</title>
<meta name="author" content="Guangwang Huang">
<meta name="referrer" content="no-referrer">
<link href= "static/style.css" rel="stylesheet" type="text/css" /></head>
<body>
<div id="preamble" class="status"><div class="header">
<div class="sitelinks">
    <a href="https://github.com/whatacold">GitHub</a> | <a href="https://stackoverflow.com/users/910978/whatacold">Stack Overflow</a> | <a href="mailto:whatacold@gmail.com">Email</a> | <a href="/rss.xml">RSS</a>
</div></div>
<div id="content">

<div class="post-date">29 Sep 2019</div><h1 class="post-title"><a href="2019-09-29-how-to-run-the-bleeding-edge-code-of-qtile-within-virtualenv.html">How to run the bleeding-edge code of Qtile within a virtualenv</a></h1>
<p>
For having been using GNOME for quite a long time, I was considering trying some tiling window managers to see what it's like a few weeks ago. Along the way, I found a nice window manager written in Python: <a href="http://www.qtile.org">Qtile</a>, what interests me most is that it's a <b>hackable</b> window manager, which makes it flexible to extend or change its behaviors.
</p>

<p>
Well, switching to use a tiling window manager is far simpler than I thought. There are two ways to have it:
</p>
<ol class="org-ol">
<li>Installing it via the system's package manager, e.g. <code>dnf</code> for Fedora</li>
<li>Installing it from the source code repo.</li>
</ol>

<p>
If you just want to give it a try, you can just install it via a package manager, logout the current X session, and re-login with Qtile as your window manager (there are options when you log in), and you're done. It's that simple.
</p>

<p>
As Qtile is still under development, I would like to run the bleeding-edge source code to catch up with Qtile.
</p>

<p>
As in the <a href="http://docs.qtile.org/en/latest/manual/install/index.html#qtile">docs</a> , it's quite straight-forward to install it.
</p>

<div class="org-src-container">
<pre class="src src-shell">git clone git://github.com/qtile/qtile.git
<span style="color: #2c3e50;">cd</span> qtile
pip3 install .
</pre>
</div>

<p>
But it will pollute the environment, so I'd rather contain it within a virtualenv, here are the steps how to run it within a dedicated virtualenv for user <code>foo</code> on Fedora.
</p>

<ol class="org-ol">
<li><p>
Clone the repo
</p>

<div class="org-src-container">
<pre class="src src-shell">mkdir -p ~/local/
git clone https://github.com/qtile/qtile.git
</pre>
</div></li>

<li><p>
Create a new virtualenv, and install dependencies there
</p>

<div class="org-src-container">
<pre class="src src-shell">python3 -m venv ~/local/qtile/qtile-env/
<span style="color: #2c3e50;">source</span> ~/local/qtile/qtile-env/bin/activate

<span style="color: #95a5a6; font-style: italic;"># </span><span style="color: #95a5a6; font-style: italic;">Install dependencies</span>
pip install xcffib
pip install --no-cache-dir cairocffi
</pre>
</div></li>

<li><p>
Make a glue shell script to use the virtualenv
</p>

<div class="org-src-container">
<pre class="src src-shell">cat &gt; /home/foo/local/qtile/qtile-venv-entry &lt;&lt;EOF
<span style="color: #16a085;">#!/bin/bash</span>

<span style="color: #16a085;"># This glue shell is only needed when you want to</span>
<span style="color: #16a085;"># run Qtile within a virtualenv</span>

<span style="color: #16a085;">source ~/local/qtile/qtile-env/bin/activate</span>
<span style="color: #16a085;">python ~/local/qtile/bin/qtile $*</span>
<span style="color: #16a085;">EOF</span>
</pre>
</div>

<p>
Also, make sure to make it executable, that is, <code>chmod +x /home/foo/local/qtile/qtile-venv-entry</code>
</p></li>

<li><p>
Make a entry desktop file for the display manager
</p>

<div class="org-src-container">
<pre class="src src-shell">cat &gt; /usr/share/xsessions/qtile-venv.desktop &lt;&lt;EOF
<span style="color: #16a085;">[Desktop Entry]</span>
<span style="color: #16a085;">Name=Qtile(venv)</span>
<span style="color: #16a085;">Comment=Qtile Session Within Venv</span>
<span style="color: #16a085;">Exec=/home/foo/local/qtile/qtile-venv-entry</span>
<span style="color: #16a085;">Type=Application</span>
<span style="color: #16a085;">Keywords=wm;tiling</span>
<span style="color: #16a085;">EOF</span>
</pre>
</div>

<p>
Pay attention to the <code>Exec</code> directive, it points to the glue script.
</p></li>

<li>Log out or reboot your system, then select “Qtile(venv)” as your window manager by clicking the setting icon when logging in.</li>
</ol>
<div class="taglist"><a href="tags.html">Tags:</a> <a href="tag-python.html">Python</a> </div>
<div class="post-date">24 Sep 2019</div><h1 class="post-title"><a href="2019-09-24-how-to-revert-a-series-of-commits-with-git.html">How to revert a series of commits with Git?</a></h1>
<p>
Sometimes, I need to revert a series of commits that are already pushed, doing a git hard reset is not an option, as someone may already have new commits based on mine.
</p>

<p>
For example, assume that I've made a few commits like below:
</p>

<pre class="example">
65a2c62 * commit 10
25cad43 * commit 9
72ad583 * commit 8
ceebf9a * commit 7
acf8a11 * commit 6
28d526f * commit 5
63af1e2 * commit 4
982c71c * commit 3
0fb4c2d * commit 2
acf9da1 * commit 1
b5f9933 * commit 0
</pre>

<p>
Now for whatever reason, I need to "drop" the changes made by commit 6 to commit 10, that is, go back to commit 5 without deleting commit.
</p>

<p>
How to do that?
</p>

<p>
One way is to use <code>git revert 28d526f..HEAD</code> to reversely revert the commits, which results in below commit history:
</p>

<pre class="example">
66808e5 * Revert "commit 6"
2661e48 * Revert "commit 7"
db86ec6 * Revert "commit 8"
fde9cb5 * Revert "commit 9"
3bf102f * Revert "commit 10"
65a2c62 * commit 10
25cad43 * commit 9
72ad583 * commit 8
ceebf9a * commit 7
acf8a11 * commit 6
28d526f * commit 5
63af1e2 * commit 4
982c71c * commit 3
0fb4c2d * commit 2
acf9da1 * commit 1
</pre>

<p>
It works, but it makes too many commits, in many cases that's not what I want, I'd rather make only one commit.
</p>

<p>
So is there a better way? The other day, I found the soft reset can suite my needs.
</p>

<p>
But how is it possible? Generally, <code>git reset</code> is used to move HEAD around the commits and/or to reset the index and working tree. The magic is that a soft reset can reset HEAD to a specific commit but leave the index and working tree untouched, so if I soft-reset HEAD from "commit 5" to "commit 10", it will move HEAD directly to "commit 10", but let the index as is, so that the index has the diff from "commit 10" to "commit 5" at the same time (<a href="https://davidzych.com/difference-between-git-reset-soft-mixed-and-hard/">Difference between git reset soft, mixed and hard - davidzych.com</a> illustrates different kinds of reset in detail.)
</p>

<p>
Here are the steps:
</p>
<div class="org-src-container">
<pre class="src src-shell">git branch master-bak    <span style="color: #95a5a6; font-style: italic;"># </span><span style="color: #95a5a6; font-style: italic;">create a backup branch in case commits lost</span>
git reset --hard 28d526f <span style="color: #95a5a6; font-style: italic;"># </span><span style="color: #95a5a6; font-style: italic;">the commit 5</span>
git reset --soft master-bak
git commit -m <span style="color: #16a085;">"Revert the commits [6,10]"</span>
git diff 28d526f..HEAD   <span style="color: #95a5a6; font-style: italic;"># </span><span style="color: #95a5a6; font-style: italic;">confirm that it doesn't have any diffs</span>
</pre>
</div>

<p>
P.S. It's a bit boring to prepare git commits above, so I bake a helper script to do that:
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #95a5a6; font-style: italic;">#</span><span style="color: #95a5a6; font-style: italic;">!/bin/</span><span style="color: #2c3e50; font-style: italic;">bash</span>

<span style="color: #3498db;">COUNT</span>=0
<span style="color: #3498db;">REPO</span>=<span style="color: #16a085;">""</span>
<span style="color: #2c3e50; font-style: italic;">if</span> [ $<span style="color: #3498db;">#</span> -ne 2 ]
<span style="color: #2c3e50; font-style: italic;">then</span>
    <span style="color: #2c3e50;">echo</span> <span style="color: #16a085;">"Usage: $0 &lt;REPO-DIR&gt; &lt;COUNT&gt;"</span>
    <span style="color: #2c3e50; font-style: italic;">exit</span> 1
<span style="color: #2c3e50; font-style: italic;">fi</span>
<span style="color: #3498db;">REPO</span>=$<span style="color: #3498db;">1</span>
<span style="color: #3498db;">COUNT</span>=$<span style="color: #3498db;">2</span>

<span style="color: #2c3e50;">echo</span> <span style="color: #16a085;">"Creating the repo and cd'ing into it..."</span>
mkdir -p $<span style="color: #3498db;">REPO</span> &amp;&amp; <span style="color: #2c3e50;">cd</span> $<span style="color: #3498db;">REPO</span>
[ ! -d .git/ ] &amp;&amp; git init .

<span style="color: #2c3e50;">echo</span> <span style="color: #16a085;">"Making commits..."</span>
<span style="color: #2c3e50; font-style: italic;">for</span> i<span style="color: #2c3e50; font-style: italic;"> in</span> <span style="color: #ff00ff;">`seq 0 $COUNT`</span>;
<span style="color: #2c3e50; font-style: italic;">do</span>
    <span style="color: #2c3e50;">echo</span> <span style="color: #16a085;">"modification made by commit $i"</span> &gt;&gt; demo.txt
    git add demo.txt
    git commit -m <span style="color: #16a085;">"commit $i"</span>
<span style="color: #2c3e50; font-style: italic;">done</span>
</pre>
</div>
<div class="taglist"><a href="tags.html">Tags:</a> <a href="tag-git.html">Git</a> </div>
<div class="post-date">18 Aug 2019</div><h1 class="post-title"><a href="2019-08-18-how-to-rename-web-page-titles-in-a-lightweight-way.html">How to rename web page titles in a lightweight way</a></h1>
<p>
There are times that I need to open many web pages of some specific websites within a browser, there are so many tabs that I can't efficiently access one of them, as their favicons are all the same.
</p>

<p>
So I tried to find a way to rename their titles, preferably in a lightweight way, so that I can spot them quickly with my eyes.
</p>

<p>
The first thought came into my mind was to find some extensions to do the job. It was easy to install one with no time. But I was not very happy with the experience. It seems that it keeps the rule of renaming titles based on the URL so that the title will always be renamed if I refreshing it, which is not what I want. I'd rather want to do it in an ad-hoc way.
</p>

<p>
Then I thought maybe it can be simply done with a bookmarklet, nevertheless, it's just a simple JavaScript statement of <code>document.title = "nice-title"</code>. With that in my mind, it didn't take me much time to write this bookmarklet:
</p>
<div class="org-src-container">
<pre class="src src-js">javascript:
(<span style="color: #2c3e50; font-style: italic;">function</span> ()
 {
     <span style="color: #2c3e50; font-style: italic;">var</span> <span style="color: #3498db;">title</span> = window.prompt(<span style="color: #16a085;">"Enter new title: "</span>, <span style="color: #16a085;">""</span>);
     <span style="color: #2c3e50; font-style: italic;">if</span> (title)
     {
         document.title= title;
     }
 })()
</pre>
</div>
<div class="taglist"><a href="tags.html">Tags:</a> <a href="tag-tools.html">Tools</a> </div>
<div class="post-date">20 Jul 2019</div><h1 class="post-title"><a href="2019-07-20-generating-org-mode-outlines-for-wikihow-articles.html">Generating org-mode outlines for wikiHow articles</a></h1>
<p>
Recently I found some great articles on <a href="https://www.wikihow.com">wikiHow</a>, then I want to keep notes of them in org-mode files.
</p>

<p>
At first, I manually copied the ToC of articles, but soon I found it's tedious and takes a lot of time.
Today I wrote a Python script to help me extract the ToCs into org-mode outlines. It takes two arguments, the first one is the URL, the second one is the containing heading's level for the generated ToC in org-mode.
</p>

<p>
For example, I can run it from within an org-mode file under a heading called <code>* Test</code>, by executing <code>M-x python wikihow-org-outline.py https://www.wikihow.com/Improve-Your-English 1</code>, then the output outline will be put under the <code>* Test</code> heading.
</p>

<p>
Here is the source code:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #95a5a6; font-style: italic;">#</span><span style="color: #95a5a6; font-style: italic;">!/usr/bin/env python</span>
<span style="color: #95a5a6; font-style: italic;"># </span><span style="color: #95a5a6; font-style: italic;">-*- coding: utf-8 -*-</span>

<span style="color: #2c3e50; font-style: italic;">from</span> bs4 <span style="color: #2c3e50; font-style: italic;">import</span> BeautifulSoup
<span style="color: #2c3e50; font-style: italic;">import</span> requests
<span style="color: #2c3e50; font-style: italic;">import</span> sys

<span style="color: #2c3e50; font-style: italic;">def</span> <span style="color: #9b59b6;">gen_wikihow_org_outline</span>(url, containing_heading_level=0):
<span style="background-color: #ecf0f1;"> </span>   <span style="color: #16a085;">'''Generating a org outline for the specified article at URL.'''</span>
<span style="background-color: #ecf0f1;"> </span>   <span style="color: #3498db;">user_agent</span>=<span style="color: #16a085;">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/51.0.2704.103 Safari/537.36"</span>
<span style="background-color: #ecf0f1;"> </span>   <span style="color: #3498db;">headers</span>={<span style="color: #16a085;">"User-Agent"</span>:user_agent}
<span style="background-color: #ecf0f1;"> </span>   <span style="color: #3498db;">html</span> = requests.get(url, headers=headers).content

<span style="background-color: #ecf0f1;"> </span>   <span style="color: #3498db;">soup</span> = BeautifulSoup(html, <span style="color: #16a085;">"html.parser"</span>)
<span style="background-color: #ecf0f1;"> </span>   <span style="color: #3498db;">level_prefix</span> = <span style="color: #16a085;">'*'</span> * containing_heading_level

<span style="background-color: #ecf0f1;"> </span>   <span style="color: #3498db;">title</span> = soup.select(<span style="color: #16a085;">"h1 &gt; a"</span>)[0].get_text()
<span style="background-color: #ecf0f1;"> </span>   <span style="color: #2c3e50; font-style: italic;">print</span>(<span style="color: #16a085;">"{}* [[{}][{}]]"</span>.<span style="color: #2c3e50;">format</span>(level_prefix, url, title))

<span style="background-color: #ecf0f1;"> </span>   <span style="color: #3498db;">sections</span> = soup.select(<span style="color: #16a085;">"h3 &gt; span"</span>)
<span style="background-color: #ecf0f1;"> </span>   <span style="color: #2c3e50; font-style: italic;">for</span> section <span style="color: #2c3e50; font-style: italic;">in</span> sections:
<span style="background-color: #ecf0f1;"> </span>   <span style="background-color: #ecf0f1;"> </span>   <span style="color: #2c3e50; font-style: italic;">print</span>(<span style="color: #16a085;">"{}** {}"</span>.<span style="color: #2c3e50;">format</span>(level_prefix, section.get_text()))
<span style="background-color: #ecf0f1;"> </span>   <span style="background-color: #ecf0f1;"> </span>   <span style="color: #3498db;">subsections</span> = section.parent.parent.find_all(<span style="color: #16a085;">"b"</span>, class_=<span style="color: #16a085;">"whb"</span>)
<span style="background-color: #ecf0f1;"> </span>   <span style="background-color: #ecf0f1;"> </span>   <span style="color: #2c3e50; font-style: italic;">for</span> subsection <span style="color: #2c3e50; font-style: italic;">in</span> subsections:
<span style="background-color: #ecf0f1;"> </span>   <span style="background-color: #ecf0f1;"> </span>   <span style="background-color: #ecf0f1;"> </span>   <span style="color: #3498db;">subsection_title</span> = subsection.get_text()
<span style="background-color: #ecf0f1;"> </span>   <span style="background-color: #ecf0f1;"> </span>   <span style="background-color: #ecf0f1;"> </span>   <span style="color: #2c3e50; font-style: italic;">if</span> <span style="color: #2c3e50;">len</span>(subsection_title) &lt; 3:
<span style="background-color: #ecf0f1;"> </span>   <span style="background-color: #ecf0f1;"> </span>   <span style="background-color: #ecf0f1;"> </span>   <span style="background-color: #ecf0f1;"> </span>   <span style="color: #2c3e50; font-style: italic;">continue</span> <span style="color: #95a5a6; font-style: italic;"># </span><span style="color: #95a5a6; font-style: italic;">it may contain only ".", just work around it.</span>
<span style="background-color: #ecf0f1;"> </span>   <span style="background-color: #ecf0f1;"> </span>   <span style="background-color: #ecf0f1;"> </span>   <span style="color: #2c3e50; font-style: italic;">print</span>(<span style="color: #16a085;">"{}*** {}"</span>.<span style="color: #2c3e50;">format</span>(level_prefix, subsection_title))

<span style="color: #3498db;">containing_heading_level</span>=0

<span style="color: #2c3e50; font-style: italic;">if</span> <span style="color: #2c3e50;">len</span>(sys.argv) &lt; 2:
<span style="background-color: #ecf0f1;"> </span>   <span style="color: #2c3e50; font-style: italic;">print</span>(<span style="color: #16a085;">"Usage: {} &lt;url&gt; [containing heading level]"</span>.<span style="color: #2c3e50;">format</span>(sys.argv[0]))
<span style="background-color: #ecf0f1;"> </span>   sys.<span style="color: #7f8c8d; font-style: italic;">exit</span>(1)

<span style="color: #3498db;">url</span> = sys.argv[1]
<span style="color: #2c3e50; font-style: italic;">if</span> <span style="color: #2c3e50;">len</span>(sys.argv) == 3:
<span style="background-color: #ecf0f1;"> </span>   <span style="color: #3498db;">containing_heading_level</span> = <span style="color: #2c3e50;">int</span>(sys.argv[2])

gen_wikihow_org_outline(url, containing_heading_level)
</pre>
</div>
<div class="taglist"><a href="tags.html">Tags:</a> <a href="tag-org-mode.html">Org-mode</a> </div>
<div class="post-date">20 Jul 2019</div><h1 class="post-title"><a href="2019-07-20-understanding-align-regexp-of-emacs.html">Understanding align-regexp of Emacs</a></h1>
<p>
Emacs' <code>M-x align-regex</code> is neat when I want to align some similar text, especially when we're coding.
I use its trivial version(without prefix arg) regularly on day-to-day programming work before.
</p>

<p>
For example, I can use it to align below code quickly by:
</p>
<ol class="org-ol">
<li>Choose the region</li>
<li><code>M-x align-regexp</code> and type <code>=</code> and <code>Enter</code></li>
</ol>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #3498db;">aaaaaaaaaaaaaa</span> = fields[0]
<span style="color: #3498db;">bbb</span> = fields[1]
<span style="color: #3498db;">cccccccc</span> = fields[2]
</pre>
</div>

<p>
It will be aligned to below code, now it's better to read:
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #3498db;">aaaaaaaaaaaaaa</span> = fields[0]
<span style="color: #3498db;">bbb</span>            = fields[1]
<span style="color: #3498db;">cccccccc</span>       = fields[2]
</pre>
</div>

<p>
A few days ago, I found I didn't understand how it works when I read the code of <a href="https://github.com/manateelazycat/smart-align">smart-align</a>, A simple <code>align-regexp</code> wrapper for easier usage.
I was confused by the parameters, especially <code>REGEXP</code> and <code>GROUP</code>, and <code>SPACING</code>, here is the defun signature:
</p>

<pre class="example">
(align-regexp BEG END REGEXP &amp;optional GROUP SPACING REPEAT)
</pre>

<p>
As for <code>REGEXP</code> and <code>GROUP</code>, as in the above example, I think the regexp should be <code>\(\s-*=\)</code>, so that group 1 will be aligned by prepending spaces.
In fact, it resulted in removing the <code>=</code> for the first line, so I was wrong. The correct regex for it is <code>\(\s-*\)=</code>.
</p>

<p>
After reading a related thread <sup><a id="fnr.1" class="footref" href="#fn.1">1</a></sup> on Emacs Stack Exchange for many times and practicing it along the way, I finally figured out, <b>the key to understanding it</b> is that it works by matching the specified group pattern, then appending it with whitespaces or removing extra whitespaces, so that the alignment character after it, <code>=</code> in this case, will be aligned.
</p>

<p>
As for the <code>SPACING</code>, it means how many spaces should be kept for the "densest" line, 1 will result in <code>aaaaaaaaaaaaaa = fields[0]</code>, 2 will result in <code>aaaaaaaaaaaaaa  = fields[0]</code>, as so on.
</p>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1">1</a></sup> <div class="footpara"><p class="footpara">
The link is: <a href="https://emacs.stackexchange.com/questions/2644/understanding-of-emacs-align-regexp">https://emacs.stackexchange.com/questions/2644/understanding-of-emacs-align-regexp</a></p></div></div>


</div>
</div><div class="taglist"><a href="tags.html">Tags:</a> <a href="tag-emacs.html">Emacs</a> </div><div id="archive">
<a href="archive.html">Other posts</a>
</div>
</div>
</body>
</html>
